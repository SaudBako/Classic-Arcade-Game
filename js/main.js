const blockWidth=101,blockHeight=83,numEndBlocks=5,numStartBlocks=5;let levelDesign=[[numEndBlocks,"water"],[3,"grass"],[3,"stone"],[1,"grass"],[2,"stone"],[1,"grass"],[1,"stone"],[numStartBlocks,"grass"]],rowImages=[];for(rows of levelDesign)for(let a=0;a<rows[0];a++)rowImages.push(rows[1]);let numRows=rowImages.length;const numCols=5,areaWidth=505,areaHeight=blockHeight*numRows,allEnemies=[],allRocks=[new Rock(2,14),new Rock(1,11),new Rock(1,6),new Rock(1,7),new Rock(3,6),new Rock(3,7)];let allGems;const player=new Player,goal=new Goal(2,numEndBlocks);function makeEnemies(){allEnemies.length=0;for(let a=numEndBlocks;a<rowImages.length;a++)"stone"==rowImages[a]&&allEnemies.push(new Enemy(-1,a,300*Math.random()+50))}function makeGems(){allGems=[new Gem(4,14),new Gem(0,14),new Gem(0,11),new Gem(4,11),new Gem(1,5),new Gem(3,5)]}function makeBoundingRocks(){for(let a=0;a<numCols;a++)allRocks.push(new Rock(a,numRows-3))}makeEnemies(),makeBoundingRocks(),makeGems(),function(){let a;setCameraToPlayer=function(){a=getNewPosition(),ctx.translate(0,a)},cameraFollowPlayer=function(){newYTranslation=getNewPosition(),yDiff=newYTranslation-a,yDiffTranslation=yDiff/blockHeight,a+=yDiffTranslation,ctx.translate(0,yDiffTranslation)},getNewPosition=()=>-player.y-(4*blockHeight+36)+canvasHeight/scale,getYTranslation=()=>a}();var Engine=function(a){function b(){l.height=k.innerHeight,k.innerWidth>n?(p.style.display=k.innerHeight>k.innerWidth?"none":"flex",l.width=l.height*o):(p.style.display="none",l.width=k.innerWidth),a.canvasHeight=l.height,scale=l.width/n,m.scale(scale,scale),setCameraToPlayer()}function c(){var a=Date.now(),b=(a-i)/1e3;d(b),cameraFollowPlayer(),f(),i=a,k.requestAnimationFrame(c)}function d(a){e(a)}function e(a){allEnemies.forEach(function(b){b.update(a)}),player.update(a)}function f(){m.clearRect(-101,0,l.width+202,l.height);for(var a=0;a<numRows;a++)for(var b=0;b<numCols;b++)m.drawImage(Resources.get(imagesURLs[rowImages[a]]),b*blockWidth,a*blockHeight-spaceAboveImage);g(),UIRender()}function g(){allEnemies.forEach(function(a){a.render()}),allRocks.forEach(function(a){a.render()}),allGems.forEach(function(a){a.render()}),goal.render(),player.render()}function h(){}var i,j=document,k=window,l=j.createElement("canvas"),m=l.getContext("2d");spaceAboveImage=50,spaceBelowImage=60,restOfBlock=171-blockHeight-spaceAboveImage-spaceBelowImage,a.ctx=m,imagesURLs={stone:"images/stone-block.png",water:"images/water-block.png",grass:"images/grass-block.png"};const n=505,o=10/16;j.body.appendChild(l);const p=document.querySelector("main");k.onresize=b,b(),Resources.load(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug.png","images/char-horn-girl.png","images/Gem Orange.png","images/Selector.png","images/Rock.png"]),Resources.onReady(function(){h(),i=Date.now(),c()})}(this);const yImageRenderOffset=70;class Entity{constructor(a,b){this.x=a*blockWidth,this.y=b*blockHeight}}class Goal extends Entity{constructor(a,b){super(a,b)}render(){ctx.drawImage(Resources.get(sprites.goal),this.x,this.y-yImageRenderOffset-20),ctx.font="29.705882352941178px Comic Sans MS",ctx.fillStyle="white",ctx.fillText("Use mouse arrows or swipe to move",5,areaHeight-blockHeight-25),ctx.fillText("Avoid bugs and water",104,areaHeight-25)}}class Rock extends Entity{constructor(a,b){super(a,b)}render(){ctx.drawImage(Resources.get(sprites.rock),this.x,this.y-yImageRenderOffset)}}class Gem extends Entity{constructor(a,b){super(a,b)}render(){ctx.drawImage(Resources.get(sprites.gem),this.x+22,this.y-22,101/1.75,171/1.75)}}class Enemy extends Entity{constructor(a,b,c){super(a,b),this.speed=c}update(a){this.x+=this.speed*a,this.x>areaWidth&&(this.x=-101),this.checkCollision()}checkCollision(){this.x<player.Collider.x+player.Collider.width&&this.x+blockWidth>player.Collider.x&&this.y<player.y+blockHeight&&this.y+blockHeight>player.y&&(lost(),player.moveToStart())}render(){ctx.drawImage(Resources.get(sprites.enemy),this.x,this.y-yImageRenderOffset)}}class Player extends Entity{constructor(){super(0,0),this.moveToStart(),this.clearDirection(),this.setCollider()}setCollider(){this.Collider={x:this.x+25,width:53}}update(){if(0!=this.direction.x||0!=this.direction.y){const a={x:this.x+this.direction.x*blockWidth,y:this.y+this.direction.y*blockHeight};Player.hitsGem(a),Player.reachesGoal(a)?this.moveToStart():Player.hitsWater(a.y)?this.moveToStart():!Player.hitsRock(a)&&Player.withinGameArea(a)?this.move(a.x,a.y):this.clearDirection()}}moveToStart(){this.move(202,(numRows-numStartBlocks+1)*blockHeight)}move(a,b){this.x=a,this.y=b,this.setCollider(),this.clearDirection()}clearDirection(){this.direction={x:0,y:0}}render(){ctx.drawImage(Resources.get(sprites.player),this.x,this.y-yImageRenderOffset)}handleInput(a){"left"===a?this.direction.x=-1:"right"===a?this.direction.x=1:"up"===a?this.direction.y=-1:"down"===a?this.direction.y=1:void 0}}const sprites={player:"images/char-horn-girl.png",enemy:"images/enemy-bug.png",rock:"images/Rock.png",gem:"images/Gem Orange.png",goal:"images/Selector.png"};Player.initialPosition=4,Player.reachesGoal=function({x:a,y:b}){return a==goal.x&&b==goal.y},Player.hitsWater=function(a){return!!(a<numEndBlocks*blockHeight)&&(lost(),!0)},Player.withinGameArea=function({x:a,y:b}){return 0<=a&&a<areaWidth&&b<areaHeight},Player.hitsRock=function({x:a,y:b}){for(rock of allRocks)if(a==rock.x&&b==rock.y)return!0;return!1},Player.hitsGem=function({x:a,y:b}){for(let c=0;c<allGems.length;c++)a==allGems[c].x&&b==allGems[c].y&&(allGems.splice(c,1),gemCollected())}(function(){document.addEventListener("keyup",function(a){a.preventDefault();player.handleInput({37:"left",38:"up",39:"right",40:"down"}[a.keyCode])});let a,b;let c;document.addEventListener("touchstart",function(d){a=d.touches[0].clientX,b=d.touches[0].clientY,c=new Date().getTime(),d.preventDefault()},{passive:!1}),document.addEventListener("touchmove",function(a){a.preventDefault()},{passive:!1}),document.addEventListener("touchend",function(d){var e=Math.abs;let f=d.changedTouches[0].clientX-a,g=d.changedTouches[0].clientY-b,h=new Date().getTime()-c,i="";h<=300&&(e(f)>e(g)?0>f?i="left":i="right":e(g)>=e(f)&&(0>g?i="up":i="down")),player.handleInput(i),d.preventDefault()},{passive:!1})})(),function(){function a(a){if(c[a])return c[a];var e=new Image;e.onload=function(){c[a]=e,b()&&d.forEach(function(a){a()})},c[a]=!1,e.src=a}function b(){var a=!0;for(var b in c)c.hasOwnProperty(b)&&!c[b]&&(a=!1);return a}var c={},d=[];window.Resources={load:function(b){b instanceof Array?b.forEach(function(b){a(b)}):a(b)},get:function(a){return c[a]},onReady:function(a){d.push(a)},isReady:b}}(),function(){let a=0,b=0;gemCollected=function(){a++},lost=function(){b++},UIRender=function(){ctx.font="33.666666666666664px Comic Sans MS",ctx.fillStyle="black",ctx.fillText("Gems  "+a,5,-getYTranslation()+60),ctx.fillText("Loses  "+b,310,-getYTranslation()+60)}}();